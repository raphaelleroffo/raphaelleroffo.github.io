<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Session 5 - Choropleths & Vector geoprocessing &middot; Raphaëlle Roffo
    
  </title>

  
  <link rel="canonical" href="http://localhost:4000/2021/11/16/intro-tutorial5/">
  

  <link rel="stylesheet" href="http://localhost:4000/public/css/poole.css">
  <link rel="stylesheet" href="http://localhost:4000/public/css/syntax.css">
  <link rel="stylesheet" href="http://localhost:4000/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="http://localhost:4000/public/favicon.ico">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="http://localhost:4000/atom.xml">

  
</head>


  <body class="theme-base-08">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox" >

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>A space for sharing my projects, research interests and GIS training material</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="http://localhost:4000/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="http://localhost:4000/about/">About</a>
        
      
    
      
    
      
        
          <a class="sidebar-nav-item" href="http://localhost:4000/data-science/">Data Science Portfolio</a>
        
      
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="http://localhost:4000/presentations/">Public speaking and publications</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="http://localhost:4000/teaching/">Teaching</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="http://localhost:4000/tuto1-intro-to-gis/">Tutorials - Intro to GIS</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="http://localhost:4000/tuto2-advanced-gis/">Tutorials - Advanced GIS</a>
        
      
    

    <span class="sidebar-nav-item">Currently v1.1.0</span>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2021. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Raphaëlle Roffo</a>
            <small>Geospatial data science portfolio & training material</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">Session 5 - Choropleths & Vector geoprocessing</h1>
  <span class="post-date">16 Nov 2021</span>
  <p><strong>Introduction to GIS  ·  Sciences Po Urban School, GETEC Masters  ·  Fall semester 2021-2022</strong></p>

<p>Lecturer: Raphaëlle Roffo</p>

<p> </p>

<h2 id="i-session-5-overview">I. Session 5 Overview</h2>

<p><strong>Download the <a href="https://github.com/raphaelleroffo/intro-to-gis/raw/main/Session5/Intro%20to%20GIS%20-%20session%205.pdf">slides</a></strong></p>

<ul>
  <li><em>Use cases; why may you need to buffer, clip, intersect?</em></li>
  <li><em>“Crossing” multiple layers: common geoprocessing tools</em></li>
  <li><em>…</em></li>
</ul>

<p> </p>

<h2 id="ii-tutorial">II. Tutorial</h2>

<h3 id="goals">Goals:</h3>

<ul>
  <li>Building a choropleth</li>
  <li>Defining relevant class breaks</li>
  <li>Running simple geoprocessing tools</li>
  <li>Adding map layout elements (legend, title, etc.) using the Print Layout Composer</li>
  <li>Exporting a map as an image, PDF or SVG vector</li>
</ul>

<p> </p>

<h3 id="context">Context:</h3>

<p>This is part 2 of a tutorial in which we’re exploring the theme of cycling to school (find part 1 <a href="https://raphaelleroffo.github.io/intro-to-gis/intro-tutorial4.html">here</a>).</p>

<p>In the context of the Covid pandemic, the question of safely getting kids to attend school has become a key element in many countries’ economic recovery strategies. Taking into considerations the pressing challenges of reducing carbon emissions, walking and cycling to school represent sustainable and safe ways for children and their parents to get to school, as long as proper cycling infrastructure exists.</p>

<p>We are focusing on the accessibility to public transport score available in the census data. We’re crossing information from the census with locations of primary schools in Greater London, and existing and planned major cycling routes. This is within the context of the GLA (Greater London Authority) plan for reducing carbon emissions, in particular with an expansion on the <a href="https://data.london.gov.uk/dataset/ultra_low_emissions_zone_expansion_new">Ultra Low Emission Zone</a> since 25 October 2021.</p>

<p> </p>

<h3 id="data">Data:</h3>

<p>We will pick up from where you left at the end of <a href="https://raphaelleroffo.github.io/intro-to-gis/intro-tutorial4.html">Session 4</a>; you can directly work from the project file <code class="language-plaintext highlighter-rouge">Session4-London</code> inside the <a href="https://github.com/raphaelleroffo/intro-to-gis/raw/main/Session4/Session4-London.gpkg">Session 4 geopackage</a>. Make sure the CRS is set to <code class="language-plaintext highlighter-rouge">EPSG:27700</code> and try using a basemap of your choice from the <code class="language-plaintext highlighter-rouge">XYZ Tiles</code> section of your <code class="language-plaintext highlighter-rouge">Browser</code> panel (go back to the Session 3 tutorial for more information on how to load basemaps). I’m using <code class="language-plaintext highlighter-rouge">CartoDb Positron</code>.</p>

<p><img src="../../../../docs/assets/images/S5-01.png" width="700" /></p>

<p>**Please also download the geopackage for this session <a href="https://github.com/raphaelleroffo/intro-to-gis/raw/main/Session5/Session5-London.gpkg">here</a> to access a completed version of this tutorial. **</p>

<p> </p>

<h2 id="iii-building-a-choropleth">III. Building a choropleth</h2>

<p>We will now focus on the London boroughs. More specifically, one field in the London Borough census data is of interest to us: <strong>The Average Public Transport accessibility Score</strong>. We’d like to create a choropleth in which each borough takes a colour that symbolizes the “intensity” of that score. For instance, we could pick a white to dark blue colour ramp. The darker the blue, the better the boroughs scored in terms of accessibility to public transport.</p>

<h3 id="31-changing-a-fields-data-type"><strong>3.1 Changing a field’s data type</strong></h3>

<p>We want to apply a <code class="language-plaintext highlighter-rouge">Graduated symbology</code>. However, our accessibility score field does not appear when we try to select a value. Can you guess why?</p>

<p><img src="../../../../docs/assets/images/S5-02.png" width="700" /></p>

<p> </p>

<p>Let’s inspect our values. You can see in the attribute table that the values in this field are numeric, decimal values. However, in your <code class="language-plaintext highlighter-rouge">Layer Properties</code> window, under the <code class="language-plaintext highlighter-rouge">Fields</code> tab, you can see a little <code class="language-plaintext highlighter-rouge">abc</code> symbol in the <code class="language-plaintext highlighter-rouge">Id</code> column. This means that your field is of a data type <code class="language-plaintext highlighter-rouge">string</code> (text). Strings cannot be used to create a graduated symbology, because each value is treated like an individual category and not like a number part of a continuous variable.</p>

<p><img src="../../../../docs/assets/images/S5-03.png" width="700" /></p>

<p> </p>

<p>We need to transform the data type of this field. More precisely, we will create a new field that takes the same values as our score but save them as decimal numbers instead of strings.</p>

<p>In your <code class="language-plaintext highlighter-rouge">Fields</code> tab, click on the little calculator. This opens a window that probably looks familiar to you by now! What you want to do is to create a new field. Give it a meaningful name, for instance <strong>Public_Transport_Access_Level</strong>, and make sure you select <code class="language-plaintext highlighter-rouge">Decimal number (real)</code> as your Output field type.</p>

<p>Next, let’s find the function that will help us convert the data type. Unroll the <code class="language-plaintext highlighter-rouge">Conversions</code> category, and find the <code class="language-plaintext highlighter-rouge">to_real</code> function whose name is pretty self-explanatory. DOuble-click to bring it to your expression area.</p>

<p><img src="../../../../docs/assets/images/S5-04.png" width="700" /></p>

<p> </p>

<p>In the middle section, unroll the <code class="language-plaintext highlighter-rouge">Fields and Values</code> category and double click  <code class="language-plaintext highlighter-rouge">Census_Average_Public_Transport_Accessibility_score,_2014</code>. Make sure you close the brackets after your field name so that the expression is valid. Press <code class="language-plaintext highlighter-rouge">OK</code>.</p>

<p><img src="../../../../docs/assets/images/S5-05.png" width="700" /></p>

<p> </p>

<p>Your new field is now available as the last field in your <code class="language-plaintext highlighter-rouge">Fields</code> tab and  in your attribute table. Notice that now the yellow pen is activated (you can see it in your layer list and at the top of your <code class="language-plaintext highlighter-rouge">Fields</code> tab). This means that you have entered the Edition mode; you are <strong>actually altering the dataset</strong> you’re working with. This is a big difference from everything we’ve done so far! Now press the yellow pen and  click <code class="language-plaintext highlighter-rouge">Save</code>. The additional column you have created is now part of the source dataset - the dataset file on your computer has been permanently modified. This is why we chose to Create a new column rather than directly modifying the initial column - we wanted to make sure that we have a backup of the original column in case we made a mistake.</p>

<p><img src="../../../../docs/assets/images/S5-06.png" width="700" /></p>

<p> </p>

<h3 id="32-the-refactoring-tool"><strong>3.2 The Refactoring tool</strong></h3>

<p>Note that instead of using the calculator to create a new field, you could have used the <code class="language-plaintext highlighter-rouge">Refactor fields</code> tool in the Processing toolbox. This tool allows you to create a copy of your layer, but where you have edited data types, fields names or even which fields you want to be present in the new attribute table and in which order.</p>

<p><img src="../../../../docs/assets/images/S5-10.png" width="700" /></p>

<p> </p>

<p>Give it a try!</p>

<p> </p>

<h3 id="33-defining-class-breaks"><strong>3.3 Defining class breaks</strong></h3>

<p>If you navigate back to your <code class="language-plaintext highlighter-rouge">Symbology</code> tab and select the <code class="language-plaintext highlighter-rouge">Graduated symbology</code> method, you will notice that your new field is available as a <code class="language-plaintext highlighter-rouge">Value</code>. Click <code class="language-plaintext highlighter-rouge">Classify</code> to bring up the values of that field. You can see that values range from 2.4 to 7.9</p>

<p><img src="../../../../docs/assets/images/S5-07.png" width="700" /></p>

<p> </p>

<p>Now it’s time to think about the way we’re going to classify this data. Because we’re working with data from an index, we will first have a look at the methodology documentation of this index. It turns out this data comes from the Public Transport Access Level Score (PTAL), which is published by Transport for London, available on the <a href="[https://data.london.gov.uk/dataset/public-transport-accessibility-levels">London Datastore</a> and with a <a href="https://airdrive-secure.s3-eu-west-1.amazonaws.com/london/dataset/public-transport-accessibility-levels/2017-01-12T15%3A59%3A45/connectivity-assessment-guide.pdf?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAJJDIMAIVZJDICKHA%2F20211110%2Feu-west-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20211110T151706Z&amp;X-Amz-Expires=300&amp;X-Amz-Signature=985d193dc9fc2a91b2e0abe5b2ec62f8f768ba03b3d476ecbf385d9367236ab8&amp;X-Amz-SignedHeaders=host](https://tfl.gov.uk/cdn/static/cms/documents/connectivity-assessment-guide.pdf)">methodology note</a> available. The values range from 0 (poor access) to 6b (excellent access). This directly gives us the class breaks we should use to respect the proper classification, the way it was designed to be used (each integer is a class break, and 7 is actually the break for “6b” in the official classification). We don’t have anything between 0 and 2, so for this map we’ll limit our legend to the range that’s actually present in our data:</p>

<table>
  <tbody>
    <tr>
      <td>2</td>
      <td>3</td>
      <td>4</td>
      <td>5</td>
      <td>6=6a</td>
      <td>7=6b</td>
    </tr>
  </tbody>
</table>

<p> </p>

<p>Note that if we did not have official “instructions” on how to define class breaks, we would go in the <code class="language-plaintext highlighter-rouge">Histogram</code> tab and press <code class="language-plaintext highlighter-rouge">Load values</code> to bring up a histogram of your variable’s distribution. We would then examine where the mean and standard deviations are located, and look for identifiable clusters or natural breaks in this histogram</p>

<p><img src="../../../../docs/assets/images/S5-11.png" width="700" /></p>

<p> </p>

<p>We would alternate the different methods and get back to the histogram to get a preview of which sections of the distribution get assigned which colour.</p>

<p><img src="../../../../docs/assets/images/S5-08.png" width="700" /></p>

<p> </p>

<p>For now, let’s manually edit our categories. First, make sure you change the classes number to 6. Then, just double click on the values and a pop-up will prompt you to enter the class bounds. Finally, click on each legend item to edit its value to the official PTAL score.</p>

<p><img src="../../../../docs/assets/images/S5-12.png" width="700" /></p>

<p> </p>

<p>This is the result you want. Press Apply.</p>

<p><img src="../../../../docs/assets/images/S5-13.png" width="700" /></p>

<p> </p>

<p>What we can do now is also rename our layer <code class="language-plaintext highlighter-rouge">Public Transport Access Level (PTAL)</code>. Navigate to the <code class="language-plaintext highlighter-rouge">Source</code> tab, change the name and click <code class="language-plaintext highlighter-rouge">Apply</code>. You can see that this has affected your layer in the <code class="language-plaintext highlighter-rouge">Layers</code> panel.</p>

<p><img src="../../../../docs/assets/images/S5-14.png" width="700" /></p>

<p> </p>

<h3 id="33-defining-symbology"><strong>3.3 Defining symbology</strong></h3>

<p>Now go back to your <code class="language-plaintext highlighter-rouge">Symbology</code> tab. We pick a simple colour ramp that ranges from white to dark blue.</p>

<p><img src="../../../../docs/assets/images/S5-15.png" width="700" /></p>

<p> </p>

<p>Unsurprisingly, we observe that the hypercentre of London benefits from great public transport access levels, whereas the further boroughs are poorly connected.</p>

<p><img src="../../../../docs/assets/images/S5-16.png" width="700" /></p>

<p> </p>

<p>Now the Ultra low Emissions Zone (ULEZ) layer looks a bit busy. Let’s edit the symbology to a strong green line and very low opacity green:</p>

<p><img src="../../../../docs/assets/images/S5-17.png" width="700" /></p>

<p> </p>

<h3 id="34-try-it-out"><strong>3.4 Try it out!</strong></h3>

<p>Now, pick a field of your choice in the London Boroughs layer. You can drag a new copy of this layer on your canvas from your side <code class="language-plaintext highlighter-rouge">Browser</code> panel, and untick the PTAL layer in your <code class="language-plaintext highlighter-rouge">Layers</code> panel to avoid confusion. In the <code class="language-plaintext highlighter-rouge">Fields</code> tab, find a field you are interested in, and try to build a choropleth like we just did (repeat and adapt all the steps from section III). If you want to try several fields, you may want to use the <code class="language-plaintext highlighter-rouge">Refactor fields</code> tool instead of the field calculator when you convert the data type to numeric.</p>

<p> </p>

<h2 id="iv-geoprocessing">IV. Geoprocessing</h2>

<p>Next, we decide that we actually want to restrict our analysis to the boundaries of the ULEZ (Ultra low Emissions Zone), to focus on the existing cycling and public transport offer in this zone. To do so, we will <strong>clip</strong> our 3 layers of interest (Schools, PTAL, cycling routes) to the extent of the ULEZ boundaries.</p>

<p> </p>

<h3 id="41-the-processing-toolbox"><strong>4.1 The processing toolbox</strong></h3>

<p>Your processing toolbox references <strong>all</strong> the operations and tools available in QGIS. Many of these tools can be accessed from elsewhere in your interface, but you can use your processing toolbox to find them all.</p>

<p>To bring up your processing toolbox if it’s not there already, navigate to your top meny: <code class="language-plaintext highlighter-rouge">View</code> &gt; <code class="language-plaintext highlighter-rouge">Panels</code> &gt; <code class="language-plaintext highlighter-rouge">Processing toolbox</code>.</p>

<p><img src="../../../../docs/assets/images/S5-18.png" width="700" /></p>

<p>As you can see, functions are tidied in categories. If we look into the <code class="language-plaintext highlighter-rouge">Vector overlay</code> category, you’ll notice that it contains the same function as those in your top menu <code class="language-plaintext highlighter-rouge">Vector</code> &gt; <code class="language-plaintext highlighter-rouge">Geoprocessing Tools</code>, for instamce the <code class="language-plaintext highlighter-rouge">Clip</code> and <code class="language-plaintext highlighter-rouge">Difference</code> tools.</p>

<p><img src="../../../../docs/assets/images/S5-19.png" width="700" /></p>

<p> </p>

<p>You can also use the search bar to retrieve any tool.</p>

<p> </p>

<h3 id="42-clipping"><strong>4.2 Clipping</strong></h3>

<p>Type <code class="language-plaintext highlighter-rouge">Clip</code> in the search bar or access it through your top <code class="language-plaintext highlighter-rouge">Vector</code> menu. The clip tool works like a “cookie-cutter”; your “dough” is your <strong>input layer</strong>, and the shape of the cookie you want to cut is your <strong>overlay polygon</strong>. Please refer to the lecture <a href="https://github.com/raphaelleroffo/intro-to-gis/raw/main/Session5/Intro%20to%20GIS%20-%20session%205.pdf">slides</a> for more details.</p>

<p>Choose first your schools as input; we’re going to clip this layer to the shape of the ULEZ. Notice that by default QGIS will create a temporary (scratch) layer. This means that the new dataset created is not saved anywhere on your disk, it’s just in memory. You can use the three dots to directly navigate to your session geopackage and save it there. You can also just run it as is for now and save the layer after (we’ll demonstrate this for now). Press <code class="language-plaintext highlighter-rouge">Run</code>.</p>

<p><img src="../../../../docs/assets/images/S5-20.png" width="700" /></p>

<p> </p>

<p>After running the clip algorithm, a message appears in the Log window to confirm that it ran successfully (You can also see a new <code class="language-plaintext highlighter-rouge">Clipped</code> layer in your Layers panel). When running geoprocessing tools, make sure you read the messages in there. If a tool fails, you will get an error message that should point you to the reasons the tool failed and help you debug.</p>

<p><img src="../../../../docs/assets/images/S5-21.png" width="700" /></p>

<p> </p>

<p>You can now press <code class="language-plaintext highlighter-rouge">Close</code>. In your <code class="language-plaintext highlighter-rouge">Layers</code> panel, untick the school layer to see your new Clipped layer more clearly. We’re now going to make use of a very handy QGIS function: we’re going to copy the style of the Greater London Schools layer and paste it onto the clipped layer: on your London schools layer, right click then <code class="language-plaintext highlighter-rouge">Styles</code> &gt; <code class="language-plaintext highlighter-rouge">Copy styles</code> &gt; <code class="language-plaintext highlighter-rouge">All Style Categories</code>.</p>

<p><img src="../../../../docs/assets/images/S5-22.png" width="700" /></p>

<p> </p>

<p>Then on your Clipped layer: right click then <code class="language-plaintext highlighter-rouge">Styles</code> &gt; <code class="language-plaintext highlighter-rouge">Paste styles</code> &gt; <code class="language-plaintext highlighter-rouge">All Style Categories</code>.</p>

<p><img src="../../../../docs/assets/images/S5-23.png" width="700" /></p>

<p> </p>

<p>In two clicks, you have fine-tuned the style of your clipped layer! Now let’s make sure we don’t lose this new dataset. If you haven’t saved it to a location on your disk when you ran the <code class="language-plaintext highlighter-rouge">Clip</code> tool, you will notice that the “hairy box” scratch layer symbol is here.</p>

<p>Then on your Clipped layer: right click then <code class="language-plaintext highlighter-rouge">Styles</code> &gt; <code class="language-plaintext highlighter-rouge">Paste styles</code> &gt; <code class="language-plaintext highlighter-rouge">All Style Categories</code>.</p>

<p><img src="../../../../docs/assets/images/S5-24.png" width="700" /></p>

<p>  
Click on that hairy box (or right click &gt; <code class="language-plaintext highlighter-rouge">Make Permanent...</code>) to save the layer to your work session geopackage.</p>

<p><img src="../../../../docs/assets/images/S5-25.png" width="700" /></p>

<p> </p>

<h3 id="43-your-turn-to-clip"><strong>4.3 Your turn to clip!</strong></h3>

<p>Now it’s your turn! Repeat the operation for the <code class="language-plaintext highlighter-rouge">Tfl_Cycleroutes</code> and the <code class="language-plaintext highlighter-rouge">Public Transport Access Levels (PTAL)</code> layers.</p>

<p>To avoid confusion in your <code class="language-plaintext highlighter-rouge">Layers</code> panel, you can rename the layers to meaningful names</p>

<p><img src="../../../../docs/assets/images/S5-26.png" width="700" /></p>

<p> </p>

<p>For clarity, you can untick your Greater London wide layers and move them to the bottom of your <code class="language-plaintext highlighter-rouge">Layers</code> list.</p>

<p><img src="../../../../docs/assets/images/S5-27.png" width="700" /></p>

<p> </p>

<h3 id="44-fine-tuning-the-symbology"><strong>4.4 Fine-tuning the symbology</strong></h3>

<p>Now let’s change one last thing: the symbology of our ULEZ zone. We’ll copy the styles from the <code class="language-plaintext highlighter-rouge">London_Contours</code> layer (the shapeburst inverted polygon) and paste it onto the <code class="language-plaintext highlighter-rouge">Ultra_Low_Emissions_Zone</code> layer. That way, we are masking slightly everything that’s outside the ULEZ.</p>

<p><img src="../../../../docs/assets/images/S5-28.png" width="700" /></p>

<p> </p>

<p>Untick your <code class="language-plaintext highlighter-rouge">London_Contours</code> layer and right click your <code class="language-plaintext highlighter-rouge">Ultra_Low_Emissions_Zone</code> layer &gt; <code class="language-plaintext highlighter-rouge">Zoom to layer</code>.</p>

<p><img src="../../../../docs/assets/images/S5-29.png" width="700" /></p>

<p> </p>

<p>We also remove the scale dependent visibility setting for our <code class="language-plaintext highlighter-rouge">ULEZ_CycleRoutes</code> layer by right-clicking &gt; <code class="language-plaintext highlighter-rouge">Set Layer Scale Visibility...</code> and unticking the <code class="language-plaintext highlighter-rouge">Scale Visibility</code> box.</p>

<p><img src="../../../../docs/assets/images/S5-30.png" width="700" /></p>

<p> </p>

<p>Let’s have a look at this map. Does is tell us much about which schools are actually near a cycling lane vs those that are not?</p>

<p><img src="../../../../docs/assets/images/S5-31.png" width="700" /></p>

<p> </p>

<h3 id="45-working-with-distance"><strong>4.5 Working with distance</strong></h3>

<p>We’re interested in finding out which schools are within 200m of a cycling lane, suggesting that the children and family can potentially use the major cycling routes to commute. We could imagine that later on, we want to compare the ratio of public schools vs private schools in the ULEZ, and in the subgroup of ULEZ schools that are within walking distance from a cycling route.</p>

<p>We’re going to use the <code class="language-plaintext highlighter-rouge">Join attributes by nearest</code> tool. Use your processing toolbox search bar to open the tool. Your input layer will e the <code class="language-plaintext highlighter-rouge">ULEZ_Schools</code>. Your join layer, the <code class="language-plaintext highlighter-rouge">ULEZ_CycleRoutes</code>. Now, very important steps: make sure to tick the <code class="language-plaintext highlighter-rouge">Discard records which couldn't be joined</code>, and to specify a <code class="language-plaintext highlighter-rouge">Maximum distance</code> of 200 meters. Press <code class="language-plaintext highlighter-rouge">Run</code>.</p>

<p><img src="../../../../docs/assets/images/S5-32.png" width="700" /></p>

<p> </p>

<p>What we are doing here is checking the distance between each school and the nearest <code class="language-plaintext highlighter-rouge">ULEZ_CycleRoutes</code>. When the distance is below 200m, we take the row from that school and join attributes (add columns) from the nearest <code class="language-plaintext highlighter-rouge">ULEZ_CycleRoutes</code> to this row. If no cycle path is within a 200m radius of a school, no join is performed and the row is dropped from the table. The output is a subset of the <code class="language-plaintext highlighter-rouge">ULEZ_Schools</code> layer in which each row is a school that is within 200m of a cycling route (all the other school rows were dropped).</p>

<p><img src="../../../../docs/assets/images/S5-33.png" width="700" /></p>

<p> </p>

<p>You can now save that layer into your geopackage, rename it, copy the style from the <code class="language-plaintext highlighter-rouge">ULEZ_Schools</code> layer and paste it into this new layer, and turn off the original <code class="language-plaintext highlighter-rouge">ULEZ_Schools</code> layer. This is your final map:</p>

<p><img src="../../../../docs/assets/images/S5-34.png" width="700" /></p>

<p> </p>

<p>For clarity, in my <code class="language-plaintext highlighter-rouge">Layers</code> panel I am now grouping together the layers I am no longer using, in a group called <code class="language-plaintext highlighter-rouge">Greater London</code>.</p>

<p><img src="../../../../docs/assets/images/S5-34bis.png" width="700" /></p>

<p> </p>

<h2 id="v-exporting-a-map-setting-up-a-layout-and-adding-map-elements-north-arrow-scale-bar-legend-title-etc">V. Exporting a map: setting up a layout and adding map elements (north arrow, scale bar, legend, title etc.)</h2>

<h3 id="51-introducing-the-print-layout-composer"><strong>5.1 Introducing the Print Layout Composer</strong></h3>

<p>We’ve established that GIS files ( <code class="language-plaintext highlighter-rouge">*.gqz</code> or geopackages) are a “recipe” to represent datasets as layers, and to display them in a specific way. Such files are <em>not</em> images; if you want to export an image of your map (as <code class="language-plaintext highlighter-rouge">*.png</code>, <code class="language-plaintext highlighter-rouge">*.jpeg</code>, <code class="language-plaintext highlighter-rouge">*.pdf</code> or even to a printer directly), you must use the QGIS <code class="language-plaintext highlighter-rouge">Print Layout Composer</code>, which you can access from your menu <code class="language-plaintext highlighter-rouge">Project</code> &gt; <code class="language-plaintext highlighter-rouge">New Print Layout...</code>. Give it a name such as <code class="language-plaintext highlighter-rouge">Session5-layout</code> and press Enter.</p>

<p><img src="../../../../docs/assets/images/S5-35.png" width="700" /></p>

<p> </p>

<p><em>Note that this layout, and the changes you make to it (and save) will now be accessible from your top menu <code class="language-plaintext highlighter-rouge">Project</code> &gt; <code class="language-plaintext highlighter-rouge">Layouts</code> &gt; …</em></p>

<p><img src="../../../../docs/assets/images/S5-37.png" width="700" /></p>

<p> </p>

<p>Back to your layout composer! It is for now a simple white space. Right-click on this blank space, select <code class="language-plaintext highlighter-rouge">Page properties…</code> and look at the context menu to your right. Make sure that you’re working with an A4 map and the orientation is Landscape. Now we can start thinking about the elements to add to our layout. You can use the top menu <code class="language-plaintext highlighter-rouge">Add items</code> to access the various layout elements, or the corresponding icons to the left of the window.</p>

<p><img src="../../../../docs/assets/images/S5-36.png" width="700" /></p>

<p> </p>

<p>First we’ll want to add a Map. Click the <code class="language-plaintext highlighter-rouge">Add Map</code> button. With this tool activated (button looks pressed down), you can place a map on the page. Click and maintain your mouse pressed to draw a box on the blank page:</p>

<p><img src="../../../../docs/assets/images/S5-38.png" width="700" /></p>

<p>Once you release, your map appears on the page. You can move the box and edit its dimensions as much as you need. Now, let’s explore how it links to your map canvas. Go back to your map canvas and switch to a different spatial bookmark view (in my case: the <code class="language-plaintext highlighter-rouge">City &amp; Canary Wharf</code> zoom). You can use this button to update the map on your layout to match the extent on the map canvas. You can also use the refresh button next to this one to refresh your layout when you’ve changed the layers that are turned on / off on your canvas. Please also note that a <code class="language-plaintext highlighter-rouge">Save</code> button is available for you to frequently save your changes to the layout.</p>

<p><img src="../../../../docs/assets/images/S5-39.png" width="700" /></p>

<p> </p>

<p>You can go back to the full ULEZ extent.</p>

<p> </p>

<h3 id="52-adding-a-legend"><strong>5.2 Adding a legend</strong></h3>

<p>Let’s add a legend to our map. Use the top <code class="language-plaintext highlighter-rouge">Add Items</code> menu or the side bar to press the <code class="language-plaintext highlighter-rouge">Add Legend</code> button. Then, just like you did to add a map, draw a square and release to place your legend.</p>

<p><img src="../../../../docs/assets/images/S5-40.png" width="700" /></p>

<p> </p>

<p>You can see that this will need a bit of cleaning:</p>

<p><img src="../../../../docs/assets/images/S5-41.png" width="700" /></p>

<p> </p>

<p>Notice that in your side panel, the <code class="language-plaintext highlighter-rouge">Items properties</code> panel content changes depending on which item is clicked. If you click onto your map, you get the map properties. Make sure you are clicked onto your legend as we start editing it. First, give it a title <code class="language-plaintext highlighter-rouge">Legend</code>, and untick the <code class="language-plaintext highlighter-rouge">Auto update</code> ; this will allow you to manually remove or add items from the legend. To scroll down this menu and see the rest of the options, you may need to use the scroll bar on the right.</p>

<p><img src="../../../../docs/assets/images/S5-42.png" width="700" /></p>

<p> </p>

<p>When you scroll down your legent items, you wil see the <code class="language-plaintext highlighter-rouge">Greater London</code> group we created earlier. Delete it by pressing the red minus button.</p>

<p><img src="../../../../docs/assets/images/S5-43.png" width="700" /></p>

<p> </p>

<p>You can also delete the basemap (<code class="language-plaintext highlighter-rouge">CartoDB_Positron</code> in my case), and the <code class="language-plaintext highlighter-rouge">Ultra_Low_Emissions_Zone</code>. Now your legend is less busy, but still difficult to read:</p>

<p><img src="../../../../docs/assets/images/S5-44.png" width="700" /></p>

<p> </p>

<p>Let’s fix this. First, change the <code class="language-plaintext highlighter-rouge">Arrangement</code> to <code class="language-plaintext highlighter-rouge">Symbols on the left</code>. Then, you can use the <code class="language-plaintext highlighter-rouge">Edit selected item properties</code> to change the names of your legend items and make them more legible (no underscore for instance). Make sure you frequently press the <code class="language-plaintext highlighter-rouge">Save project</code> button to save your changes.</p>

<p><img src="../../../../docs/assets/images/S5-45.png" width="700" /></p>

<p> </p>

<p>Next, move on to the <code class="language-plaintext highlighter-rouge">Fonts and text formatting</code> section (below the legend items). If you want to change the font type and size, you can do so by clicking on each type of font:</p>

<p><img src="../../../../docs/assets/images/S5-46.png" width="700" /></p>

<p> </p>

<p>What we want to do here is add spacing between our items. You can access the spacing properties in the <code class="language-plaintext highlighter-rouge">Spacing</code> section, and adjust the spacing as you feel fit.</p>

<p><img src="../../../../docs/assets/images/S5-47.png" width="700" /></p>

<p> </p>

<p>For instance, you may want to increase the space between subgroups, under the legend, around the symbols:</p>

<p><img src="../../../../docs/assets/images/S5-48.png" width="700" /></p>

<p> </p>

<p>You can also add a frame and a background colour:</p>

<p><img src="../../../../docs/assets/images/S5-49.png" width="700" /></p>

<p> </p>

<h3 id="53-adding-other-map-layout-elements"><strong>5.3 Adding other map layout elements</strong></h3>

<p><strong>North Arrow</strong></p>

<p>Now let’s add a north arrow. This is the same principle again; press the <code class="language-plaintext highlighter-rouge">Add North Arrow</code> icon, and draw a box to add it to your layout.</p>

<p><img src="../../../../docs/assets/images/S5-50.png" width="700" /></p>

<p> </p>

<p>You can pick the symbol you like. If you wanted, you could also use a different symbol from your computer (in vector or raster format) by navigating to its location. For now, we choose a simple symbol.</p>

<p><img src="../../../../docs/assets/images/S5-51.png" width="700" /></p>

<p> </p>

<p>Feel free to shuffle the various layout elements position around until you find a good balance.</p>

<p> </p>

<p><strong>Scale Bar</strong></p>

<p>To add a scale bar, again you can go in your <code class="language-plaintext highlighter-rouge">Add items</code> menu or pick the logo on the side, then draw a box. An important parameter is the type of scale bar; do you want boxes, lines, or just the RF number? Here, we’ll use <code class="language-plaintext highlighter-rouge">Single Box</code>.</p>

<p><img src="../../../../docs/assets/images/S5-52.png" width="700" /></p>

<p> </p>

<p>Keep km as your unit, and 2.5 km as a unit for each box. Increase the number of segments to the right to 4 so that you represent 10km:</p>

<p><img src="../../../../docs/assets/images/S5-53.png" width="700" /></p>

<p> </p>

<p><strong>Data Sources</strong></p>

<p>Use the <code class="language-plaintext highlighter-rouge">Add label</code> tool to add text. Here we want to add our data sources and credit the basemap.</p>

<p><img src="../../../../docs/assets/images/S5-54.png" width="700" /></p>

<p> </p>

<p><strong>Title</strong></p>

<p>Finally, let’s add a title! Use the <code class="language-plaintext highlighter-rouge">Add label</code> tool again. Let’s name this map: “Primary Schools within 200m of a current or planned cycling route in the London Ultra Low Emissions Zone (2021)”. You can click on <code class="language-plaintext highlighter-rouge">Appearance</code> &gt; <code class="language-plaintext highlighter-rouge">Font</code> to pick a larger, maybe bold font. You can center the text, and you can also add a frame. Notice that if you drag the text box around, blue lines will point you to the centre of your page.</p>

<p><img src="../../../../docs/assets/images/S5-55.png" width="700" /></p>

<p> </p>

<p>Make sure to save your changes.</p>

<p> </p>
<h3 id="54-exporting-your-map"><strong>5.4 Exporting your map</strong></h3>

<p>Finally, it’s time to export your map! Simply go into your top menu <code class="language-plaintext highlighter-rouge">Layout</code> &gt; <code class="language-plaintext highlighter-rouge">Export as Image...</code>. <strong>You can also export as PDF or as a vectorial format (SVG), but it’s the same process</strong>.</p>

<p><img src="../../../../docs/assets/images/S5-56.png" width="700" /></p>

<p> </p>

<p>You may get an error message saying:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Some WMS servers (e.g. UMN mapserver) have a limit for the WIDTH and HEIGHT parameter. Printing layers from such servers may exceed this limit. If this is the case, the WMS layer will not be printed
</code></pre></div></div>

<p>This refers to the basemap we’re using. You can ignore it for now, close and continue.</p>

<p>Navigate to your working folder, give it a name and close. In the next <code class="language-plaintext highlighter-rouge">Image Export Options</code> window, you can keep the default options.</p>

<p><img src="../../../../docs/assets/images/S5-57.png" width="700" /></p>

<p> </p>

<p>That’s it, you now have successfully exported your map!</p>

<p><img src="../../../../docs/assets/images/S5-58.png" width="700" /></p>

<p> </p>

<p><strong>Well done! This is it for this tutorial - in the final tutorial of this intro course, you will explore the link between socio-economic status and exposure to flooding in London.</strong></p>

<p> </p>

<p> </p>

<p> </p>

<h3 id="next-tutorial-"><strong><a href="https://raphaelleroffo.github.io/intro-to-gis/intro-tutorial6.html">Next Tutorial &gt;</a></strong></h3>

<h3 id="back-to-the-syllabus-"><strong><a href="https://raphaelleroffo.github.io/intro-to-gis/index.html">Back to the syllabus &gt;</a></strong></h3>

</div>


<div class="related">
  <h2>Related posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2021/11/16/intro-tutorial6/">
            Session 6 - Wrap-up
            <small>16 Nov 2021</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2021/11/16/intro-tutorial4/">
            Session 4 - Cartographic design
            <small>16 Nov 2021</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2021/11/16/intro-tutorial3/">
            Session 3 - Working with vector data & the attribute table
            <small>16 Nov 2021</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script src='/public/js/script.js'></script>
  </body>
</html>
